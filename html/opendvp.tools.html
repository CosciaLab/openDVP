<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="opendvp.utils package" href="opendvp.utils.html" /><link rel="prev" title="opendvp.preprocessing package" href="opendvp.preprocessing.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>opendvp.tools package - opendvp 0.2.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">opendvp 0.2.2 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">opendvp 0.2.2 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">API Reference:</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="opendvp.html">opendvp package</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of opendvp package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="opendvp.imaging.html">opendvp.imaging package</a></li>
<li class="toctree-l2"><a class="reference internal" href="opendvp.io.html">opendvp.io package</a></li>
<li class="toctree-l2"><a class="reference internal" href="opendvp.metrics.html">opendvp.metrics package</a></li>
<li class="toctree-l2"><a class="reference internal" href="opendvp.plotting.html">opendvp.plotting package</a></li>
<li class="toctree-l2"><a class="reference internal" href="opendvp.preprocessing.html">opendvp.preprocessing package</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">opendvp.tools package</a></li>
<li class="toctree-l2"><a class="reference internal" href="opendvp.utils.html">opendvp.utils package</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/opendvp.tools.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="opendvp-tools-package">
<h1>opendvp.tools package<a class="headerlink" href="#opendvp-tools-package" title="Link to this heading">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading">¶</a></h2>
</section>
<section id="module-opendvp.tools.filter_adata_by_gates">
<span id="opendvp-tools-filter-adata-by-gates-module"></span><h2>opendvp.tools.filter_adata_by_gates module<a class="headerlink" href="#module-opendvp.tools.filter_adata_by_gates" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.filter_adata_by_gates.filter_adata_by_gates">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.filter_adata_by_gates.</span></span><span class="sig-name descname"><span class="pre">filter_adata_by_gates</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.filter_adata_by_gates.filter_adata_by_gates" title="Link to this definition">¶</a></dt>
<dd><p>Filter an AnnData object to retain only markers specified in the <cite>gates</cite> DataFrame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>AnnData</em>) – The annotated data matrix to be filtered (cells x markers).</p></li>
<li><p><strong>gates</strong> (<em>DataFrame</em>) – A DataFrame containing a ‘marker_id’ column with marker names to retain.
Optionally contains a ‘sample_id’ column for filtering markers specific to a sample.</p></li>
<li><p><strong>sample_id</strong> (<em>str</em><em>, </em><em>optional</em>) – If provided, filters the <cite>gates</cite> DataFrame to only include rows with this sample_id.</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>AnnData</strong> – A new AnnData object with the same cells but filtered to include only the gated markers.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></span></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-opendvp.tools.filter_by_abs_value">
<span id="opendvp-tools-filter-by-abs-value-module"></span><h2>opendvp.tools.filter_by_abs_value module<a class="headerlink" href="#module-opendvp.tools.filter_by_abs_value" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.filter_by_abs_value.filter_by_abs_value">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.filter_by_abs_value.</span></span><span class="sig-name descname"><span class="pre">filter_by_abs_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">marker</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'quantile'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'above'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.filter_by_abs_value.filter_by_abs_value" title="Link to this definition">¶</a></dt>
<dd><p>Filter cells in an AnnData object by absolute marker value or quantile threshold.</p>
<p>This function creates a boolean mask for each cell based on a marker’s value, using either an absolute threshold or a quantile.
The result is stored as a new column in <cite>adata.obs</cite> and the filtered AnnData is returned.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></span></p>
</dd>
</dl>
<section id="parameters">
<h3>Parameters:<a class="headerlink" href="#parameters" title="Link to this heading">¶</a></h3>
<dl class="simple">
<dt>adata<span class="classifier">ad.AnnData</span></dt><dd><p>AnnData object containing the data matrix and metadata.</p>
</dd>
<dt>marker<span class="classifier">str</span></dt><dd><p>Name of the marker to filter on (must be present in <cite>adata.var_names</cite>).</p>
</dd>
<dt>mode<span class="classifier">{‘absolute’, ‘quantile’}, default ‘quantile’</span></dt><dd><p>Whether to use an absolute value or quantile as the threshold.</p>
</dd>
<dt>value<span class="classifier">float or int, default 0.5</span></dt><dd><p>The threshold value. If mode is ‘absolute’, this is the absolute threshold. If ‘quantile’, this is the quantile (0 &lt; value &lt; 1).</p>
</dd>
<dt>keep<span class="classifier">{‘above’, ‘below’}, default ‘above’</span></dt><dd><p>Whether to keep cells ‘above’ or ‘below’ the threshold.</p>
</dd>
</dl>
</section>
<section id="returns">
<h3>Returns:<a class="headerlink" href="#returns" title="Link to this heading">¶</a></h3>
<p>:
ad.AnnData</p>
<blockquote>
<div><p>A copy of the input AnnData with a new boolean column in <cite>.obs</cite> indicating which cells passed the filter.</p>
</div></blockquote>
</section>
<section id="raises">
<h3>Raises:<a class="headerlink" href="#raises" title="Link to this heading">¶</a></h3>
<dl class="simple">
<dt>ValueError</dt><dd><p>If marker is not found, mutually exclusive arguments are violated, or parameters are invalid.</p>
</dd>
</dl>
</section>
</dd></dl>

</section>
<section id="module-opendvp.tools.filter_by_annotation">
<span id="opendvp-tools-filter-by-annotation-module"></span><h2>opendvp.tools.filter_by_annotation module<a class="headerlink" href="#module-opendvp.tools.filter_by_annotation" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.filter_by_annotation.filter_by_annotation">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.filter_by_annotation.</span></span><span class="sig-name descname"><span class="pre">filter_by_annotation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path_to_geojson</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">any_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'artefact'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.filter_by_annotation.filter_by_annotation" title="Link to this definition">¶</a></dt>
<dd><p>Filter cells by annotation in a geojson file using spatial indexing.</p>
<p>This function assigns annotation classes to cells in an AnnData object by spatially joining cell centroids
with polygons from a GeoJSON file. Each annotation class becomes a boolean column in <cite>adata.obs</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>ad.AnnData</em>) – AnnData object with cell centroids in <cite>adata.obs[[‘X_centroid’, ‘Y_centroid’]]</cite> and unique ‘CellID’.</p></li>
<li><p><strong>path_to_geojson</strong> (<em>str</em>) – Path to the GeoJSON file containing polygon annotations with a ‘classification’ property.</p></li>
<li><p><strong>any_label</strong> (<em>str</em><em>, </em><em>default 'artefact'</em>) – Name for the column indicating if a cell is inside any annotation.</p></li>
<li><p><strong>plot_QC</strong> (<em>bool</em><em>, </em><em>default True</em>) – If True, enables plotting for quality control (not implemented).</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>ad.AnnData</strong> – The input AnnData with new boolean columns in <cite>.obs</cite> for each annotation class and a summary column.</p></li>
<li><p><strong>Raises</strong></p></li>
<li><p><strong>------</strong></p></li>
<li><p><strong>ValueError</strong> – If the GeoJSON is missing geometry, not polygons, or if required columns are missing.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></span></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-opendvp.tools.filter_by_ratio">
<span id="opendvp-tools-filter-by-ratio-module"></span><h2>opendvp.tools.filter_by_ratio module<a class="headerlink" href="#module-opendvp.tools.filter_by_ratio" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.filter_by_ratio.filter_by_ratio">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.filter_by_ratio.</span></span><span class="sig-name descname"><span class="pre">filter_by_ratio</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_cycle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_cycle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'DAPI'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_ratio</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_ratio</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.05</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.filter_by_ratio.filter_by_ratio" title="Link to this definition">¶</a></dt>
<dd><p>Filter cells by the ratio of two markers in an AnnData object.</p>
<p>This function computes the ratio between two markers (columns) for each cell, and flags cells
whose ratio falls within the specified range. The results are stored as new columns in <cite>.obs</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>ad.AnnData</em>) – AnnData object containing the data matrix and metadata.</p></li>
<li><p><strong>end_cycle</strong> (<em>str</em>) – Name of the marker/column for the numerator of the ratio.</p></li>
<li><p><strong>start_cycle</strong> (<em>str</em>) – Name of the marker/column for the denominator of the ratio.</p></li>
<li><p><strong>label</strong> (<em>str</em><em>, </em><em>default 'DAPI'</em>) – Label prefix for the new columns in <cite>.obs</cite>.</p></li>
<li><p><strong>min_ratio</strong> (<em>float</em><em>, </em><em>default 0.5</em>) – Minimum allowed ratio (exclusive).</p></li>
<li><p><strong>max_ratio</strong> (<em>float</em><em>, </em><em>default 1.05</em>) – Maximum allowed ratio (exclusive).</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>ad.AnnData</strong> – The input AnnData with new columns in <cite>.obs</cite> for the ratio and pass/fail flags.</p></li>
<li><p><strong>Raises</strong></p></li>
<li><p><strong>------</strong></p></li>
<li><p><strong>ValueError</strong> – If marker names are not found or if min_ratio &gt;= max_ratio.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></span></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-opendvp.tools.filter_features_byNaNs">
<span id="opendvp-tools-filter-features-bynans-module"></span><h2>opendvp.tools.filter_features_byNaNs module<a class="headerlink" href="#module-opendvp.tools.filter_features_byNaNs" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.filter_features_byNaNs.filter_features_byNaNs">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.filter_features_byNaNs.</span></span><span class="sig-name descname"><span class="pre">filter_features_byNaNs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grouping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qc_export_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_in_ANY_or_ALL_groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ANY'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.filter_features_byNaNs.filter_features_byNaNs" title="Link to this definition">¶</a></dt>
<dd><p>Filter out proteins that have a NaN proportion above the threshold, for each group in the grouping variable.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>AnnData</em>) – AnnData object to filter.</p></li>
<li><p><strong>threshold</strong> (<em>float</em><em>, </em><em>default 0.7</em>) – Proportion of valid values above which a protein is considered valid (between 0 and 1).</p></li>
<li><p><strong>grouping</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em><em>, </em><em>default None</em>) – Name of the column in adata.obs to discriminate the groups by. If provided, filtering is done per group.</p></li>
<li><p><strong>qc_export_path</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em><em>, </em><em>default None</em>) – Path to save the dataframe with the filtering results. If None, no file is saved.</p></li>
<li><p><strong>valid_in_ANY_or_ALL_groups</strong> (<em>{'ANY'</em><em>, </em><em>'ALL'}</em><em>, </em><em>default 'ANY'</em>) – ‘ANY’ means that if a protein passes the threshold in any group it will be kept.
‘ALL’ means that a protein must pass validity threshold for all groups to be kept (more stringent).</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>AnnData</strong> – Filtered AnnData object.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></span></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-opendvp.tools.impute_gaussian">
<span id="opendvp-tools-impute-gaussian-module"></span><h2>opendvp.tools.impute_gaussian module<a class="headerlink" href="#module-opendvp.tools.impute_gaussian" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.impute_gaussian.gaussian">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.impute_gaussian.</span></span><span class="sig-name descname"><span class="pre">gaussian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_shift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1.8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">std_dev_shift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">perSample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.impute_gaussian.gaussian" title="Link to this definition">¶</a></dt>
<dd><p>Impute missing values in an AnnData object using a Gaussian distribution.</p>
<p>This function imputes missing values in the data matrix using a Gaussian distribution, with the mean shifted and
the standard deviation scaled. Imputation can be performed per protein (column) or per sample (row).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>ad.AnnData</em>) – AnnData object with missing values to impute.</p></li>
<li><p><strong>mean_shift</strong> (<em>float</em><em>, </em><em>default -1.8</em>) – Number of standard deviations to shift the mean of the Gaussian distribution.</p></li>
<li><p><strong>std_dev_shift</strong> (<em>float</em><em>, </em><em>default 0.3</em>) – Factor to scale the standard deviation of the Gaussian distribution.</p></li>
<li><p><strong>perSample</strong> (<em>bool</em><em>, </em><em>default False</em>) – If True, impute per sample (row); if False, impute per protein (column).</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>ad.AnnData</strong> – AnnData object with imputed values.</p></li>
<li><p><strong>Raises</strong></p></li>
<li><p><strong>------</strong></p></li>
<li><p><strong>ValueError</strong> – If negative values are imputed (when data is not log-transformed).</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></span></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-opendvp.tools.impute_single">
<span id="opendvp-tools-impute-single-module"></span><h2>opendvp.tools.impute_single module<a class="headerlink" href="#module-opendvp.tools.impute_single" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.impute_single.impute_single">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.impute_single.</span></span><span class="sig-name descname"><span class="pre">impute_single</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_shift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1.8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">std_dev_shift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">report_stats</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.impute_single.impute_single" title="Link to this definition">¶</a></dt>
<dd><p>Impute missing values.</p>
<p>Impute for 1D array using a Gaussian distribution in log2 space and plot the result.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>array</strong> (<em>np.ndarray</em>) – 1D array of values to impute (can contain NaNs).</p></li>
<li><p><strong>mean_shift</strong> (<em>float</em><em>, </em><em>default -1.8</em>) – How many standard deviations to shift the mean of the Gaussian distribution.</p></li>
<li><p><strong>std_dev_shift</strong> (<em>float</em><em>, </em><em>default 0.3</em>) – How much to reduce the standard deviation of the Gaussian distribution, as a fraction.</p></li>
<li><p><strong>report_stats</strong> (<em>bool</em><em>, </em><em>default True</em>) – Whether to print statistics about the imputation process.</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>None</strong> – This function only plots and logs statistics; it does not return an imputed array.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-opendvp.tools.phenotype">
<span id="opendvp-tools-phenotype-module"></span><h2>opendvp.tools.phenotype module<a class="headerlink" href="#module-opendvp.tools.phenotype" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.phenotype.phenotype_cells">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.phenotype.</span></span><span class="sig-name descname"><span class="pre">phenotype_cells</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phenotype</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'phenotype'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'imageid'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pheno_threshold_percent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pheno_threshold_abs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.phenotype.phenotype_cells" title="Link to this definition">¶</a></dt>
<dd><p>Parameters:
adata (anndata.AnnData):</p>
<blockquote>
<div><p>The input AnnData object containing single-cell data for phenotyping.</p>
</div></blockquote>
<dl class="simple">
<dt>phenotype (pd.DataFrame):</dt><dd><p>A DataFrame specifying the gating strategy for cell phenotyping. It should outline the workflow for phenotype classification based on marker expression levels. An example workflow is available at [this GitHub link](<a class="reference external" href="https://github.com/ajitjohnson/scimap/blob/master/scimap/tests/_data/phenotype_workflow.csv">https://github.com/ajitjohnson/scimap/blob/master/scimap/tests/_data/phenotype_workflow.csv</a>).</p>
</dd>
<dt>gate (float, optional):</dt><dd><p>The threshold value for determining positive cell classification based on scaled data. By convention, values above this threshold are considered to indicate positive cells.</p>
</dd>
<dt>label (str):</dt><dd><p>The name of the column in <cite>adata.obs</cite> where the final phenotype classifications will be stored. This label will be used to access the phenotyping results within the <cite>AnnData</cite> object.</p>
</dd>
<dt>imageid (str, optional):</dt><dd><p>The name of the column in <cite>adata.obs</cite> that contains unique image identifiers. This is crucial for analyses that require differentiation of data based on the source image, especially when using phenotype threshold parameters (<cite>pheno_threshold_percent</cite> or <cite>pheno_threshold_abs</cite>).</p>
</dd>
<dt>pheno_threshold_percent (float, optional):</dt><dd><p>A threshold value (between 0 and 100) specifying the minimum percentage of cells that must exhibit a particular phenotype for it to be considered valid. Phenotypes not meeting this threshold are reclassified as ‘unknown’. This parameter is useful for minimizing the impact of low-frequency false positives.</p>
</dd>
<dt>pheno_threshold_abs (int, optional):</dt><dd><p>Similar to <cite>pheno_threshold_percent</cite>, but uses an absolute cell count instead of a percentage. Phenotypes with cell counts below this threshold are reclassified as ‘unknown’. This can help in addressing rare phenotype classifications that may not be meaningful.</p>
</dd>
<dt>verbose (bool):</dt><dd><p>If set to <cite>True</cite>, the function will print detailed messages about its progress and the steps being executed.</p>
</dd>
</dl>
<p>Returns:
adata (anndata.AnnData):</p>
<blockquote>
<div><p>The input AnnData object, updated to include the phenotype classifications for each cell. The phenotyping results can be found in <cite>adata.obs[label]</cite>, where <cite>label</cite> is the name specified by the user for the phenotype column.</p>
</div></blockquote>
<p>Example:
<a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>python</p>
<p># Load the phenotype workflow CSV file
phenotype = pd.read_csv(‘path/to/csv/file/’)</p>
<p># Apply phenotyping to cells based on the specified workflow
adata = sm.tl.phenotype_cells(adata, phenotype=phenotype, gate=0.5, label=”phenotype”)</p>
<p><a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
</dd></dl>

</section>
<section id="module-opendvp.tools.spatial_autocorrelation">
<span id="opendvp-tools-spatial-autocorrelation-module"></span><h2>opendvp.tools.spatial_autocorrelation module<a class="headerlink" href="#module-opendvp.tools.spatial_autocorrelation" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.spatial_autocorrelation.spatial_autocorrelation">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.spatial_autocorrelation.</span></span><span class="sig-name descname"><span class="pre">spatial_autocorrelation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'moran'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">('x_centroid',</span> <span class="pre">'y_centroid')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">island_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.spatial_autocorrelation.spatial_autocorrelation" title="Link to this definition">¶</a></dt>
<dd><p>Compute spatial autocorrelation statistics (Moran’s I or Geary’s C) for each gene in an AnnData object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>AnnData</em>) – Annotated data matrix where observations are cells and variables are genes.</p></li>
<li><p><strong>method</strong> (<em>{'moran'</em><em>, </em><em>'geary'}</em><em>, </em><em>default 'moran'</em>) – Spatial statistic to compute: ‘moran’ or ‘geary’.</p></li>
<li><p><strong>x_y</strong> (<em>Sequence</em><em>[</em><em>str</em><em>]</em><em>, </em><em>default</em><em> (</em><em>&quot;x_centroid&quot;</em><em>, </em><em>&quot;y_centroid&quot;</em><em>)</em>) – Names of columns in <cite>adata.obs</cite> containing spatial coordinates.</p></li>
<li><p><strong>k</strong> (<em>int</em><em>, </em><em>default 8</em>) – Number of neighbors for Moran’s I (ignored for Geary’s C).</p></li>
<li><p><strong>threshold</strong> (<em>float</em><em>, </em><em>default 10.0</em>) – Distance threshold for neighbors for Geary’s C (ignored for Moran’s I).</p></li>
<li><p><strong>island_threshold</strong> (<em>float</em><em>, </em><em>default 0.1</em>) – If more than this fraction of samples are islands (no neighbors), raises error.</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>None</strong> – Results are added to adata.var in-place.</p></li>
<li><p><strong>Raises</strong></p></li>
<li><p><strong>------</strong></p></li>
<li><p><strong>ValueError</strong> – If method is not ‘moran’ or ‘geary’.</p></li>
<li><p><strong>RuntimeError</strong> – If too many islands are detected in Geary’s C mode.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-opendvp.tools.spatial_hyperparameter_search">
<span id="opendvp-tools-spatial-hyperparameter-search-module"></span><h2>opendvp.tools.spatial_hyperparameter_search module<a class="headerlink" href="#module-opendvp.tools.spatial_hyperparameter_search" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.spatial_hyperparameter_search.spatial_hyperparameter_search">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.spatial_hyperparameter_search.</span></span><span class="sig-name descname"><span class="pre">spatial_hyperparameter_search</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_df</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_network_at</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.spatial_hyperparameter_search.spatial_hyperparameter_search" title="Link to this definition">¶</a></dt>
<dd><p>Perform a hyperparameter search over a range of threshold values.</p>
<p>To determine the number of connected nodes and average neighbors for different threshold values,
and optionally plot the network of connected nodes at a given threshold.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>AnnData</em>) – Spatially indexed data.</p></li>
<li><p><strong>x_y</strong> (<em>list</em><em> of </em><em>str</em><em>, </em><em>default</em><em> [</em><em>'x_centroid'</em><em>, </em><em>'y_centroid'</em><em>]</em>) – Column names in adata.obs representing the spatial coordinates.</p></li>
<li><p><strong>threshold_range</strong> (<em>np.ndarray</em><em>, </em><em>default np.arange</em><em>(</em><em>1</em><em>, </em><em>100</em><em>, </em><em>1</em><em>)</em>) – Range of threshold values to test.</p></li>
<li><p><strong>loguru_logger</strong> (<em>Optional</em><em>[</em><em>logger</em><em>]</em><em>, </em><em>default None</em>) – Loguru logger for logging information during the process.</p></li>
<li><p><strong>return_df</strong> (<em>bool</em><em>, </em><em>default False</em>) – If True, return the DataFrame with threshold statistics along with the plot.</p></li>
<li><p><strong>plot_network_at</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em><em>, </em><em>default None</em>) – The threshold value at which to plot the network of connected nodes. If None, no plot is generated.</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>True</strong> (<em>If return_df is</em>) – <dl class="simple">
<dt>tuple[pandas.DataFrame, tuple[matplotlib.figure.Figure, matplotlib.axes.Axes]]</dt><dd><p>DataFrame with threshold statistics and the plot (figure, axes).</p>
</dd>
</dl>
</p></li>
<li><p><strong>Else</strong> – <dl class="simple">
<dt>tuple[matplotlib.figure.Figure, matplotlib.axes.Axes]</dt><dd><p>The plot (figure, axes).</p>
</dd>
</dl>
</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code> | <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></span></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-opendvp.tools.stats_anova">
<span id="opendvp-tools-stats-anova-module"></span><h2>opendvp.tools.stats_anova module<a class="headerlink" href="#module-opendvp.tools.stats_anova" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.stats_anova.anova_adata">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.stats_anova.</span></span><span class="sig-name descname"><span class="pre">anova_adata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grouping</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">FDR_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">posthoc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'pairwise_tukey'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.stats_anova.anova_adata" title="Link to this definition">¶</a></dt>
<dd><p>Perform one-way ANOVA for all columns of an AnnData object across all groups in a categorical column.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>AnnData</em>) – AnnData object.</p></li>
<li><p><strong>grouping</strong> (<em>str</em>) – Column header in adata.obs, categorizing different groups to test.</p></li>
<li><p><strong>FDR_threshold</strong> (<em>float</em><em>, </em><em>default 0.05</em>) – The threshold for the FDR correction.</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>None</strong> – Results are saved to adata.var in-place.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></span></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-opendvp.tools.stats_average_samples">
<span id="opendvp-tools-stats-average-samples-module"></span><h2>opendvp.tools.stats_average_samples module<a class="headerlink" href="#module-opendvp.tools.stats_average_samples" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.stats_average_samples.calculate_category_averages">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.stats_average_samples.</span></span><span class="sig-name descname"><span class="pre">calculate_category_averages</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">categories</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.stats_average_samples.calculate_category_averages" title="Link to this definition">¶</a></dt>
<dd><p>Calculate averages for all permutations of given categories in adata.obs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>AnnData</em>) – Annotated data matrix with observations (cells) and variables (features).</p></li>
<li><p><strong>categories</strong> (<em>list</em><em> of </em><em>str</em>) – List of categories (column names in adata.obs) to calculate averages for.</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>AnnData</strong> – AnnData object containing category combinations and their corresponding averages.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></span></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-opendvp.tools.stats_bootstrap">
<span id="opendvp-tools-stats-bootstrap-module"></span><h2>opendvp.tools.stats_bootstrap module<a class="headerlink" href="#module-opendvp.tools.stats_bootstrap" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.stats_bootstrap.bootstrap_variability">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.stats_bootstrap.</span></span><span class="sig-name descname"><span class="pre">bootstrap_variability</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataframe</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bootstrap=100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subset_sizes=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">summary_func=&lt;function</span> <span class="pre">mean&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_raw=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_summary=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_seed=42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nan_policy='omit'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv_threshold=None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.stats_bootstrap.bootstrap_variability" title="Link to this definition">¶</a></dt>
<dd><p>Evaluate the variability of feature-level coefficient of variation (CV) via bootstrapping.</p>
<p>This function samples subsets from the input DataFrame and computes the CV (standard deviation divided by mean)
of each feature (column) for each bootstrap replication. For each subset size, the function aggregates the CVs
across bootstraps and then summarizes them with a user-specified statistic (e.g., mean, median). Optionally,
the function can generate a violin plot of the summarized CVs across different subset sizes, and it returns the
bootstrapped raw CVs and/or the summarized results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataframe</strong> (<em>pandas.DataFrame</em>) – The input DataFrame containing the data (features in columns, samples in rows).</p></li>
<li><p><strong>n_bootstrap</strong> (<em>int</em><em>, </em><em>optional</em><em> (</em><em>default=100</em><em>)</em>) – Number of bootstrap replicates to perform for each subset size.</p></li>
<li><p><strong>subset_sizes</strong> (<em>list</em><em> of </em><em>int</em><em>, </em><em>optional</em><em> (</em><em>default=</em><em>[</em><em>10</em><em>, </em><em>50</em><em>, </em><em>100</em><em>]</em><em>)</em>) – List of subset sizes (number of rows to sample) to use during the bootstrapping.</p></li>
<li><p><strong>summary_func</strong> (<em>callable</em><em> or </em><em>str</em><em>, </em><em>optional</em><em> (</em><em>default=np.mean</em><em>)</em>) – Function to aggregate the per-feature CVs across bootstraps. For example, np.mean, np.median, etc.
If set to “count_above_threshold”, counts the number of CVs above <cite>cv_threshold</cite> for each feature.</p></li>
<li><p><strong>cv_threshold</strong> (<em>float</em><em> or </em><em>None</em><em>, </em><em>optional</em><em> (</em><em>default=None</em><em>)</em>) – Threshold for counting CVs above this value when summary_func is “count_above_threshold”.</p></li>
<li><p><strong>return_raw</strong> (<em>bool</em><em>, </em><em>optional</em><em> (</em><em>default=True</em><em>)</em>) – If True, returns the raw bootstrapped CVs in long format.</p></li>
<li><p><strong>return_summary</strong> (<em>bool</em><em>, </em><em>optional</em><em> (</em><em>default=True</em><em>)</em>) – If True, returns a summary DataFrame where the per-feature bootstrapped CVs have been aggregated using
<cite>summary_func</cite> for each subset size.</p></li>
<li><p><strong>plot</strong> (<em>bool</em><em>, </em><em>optional</em><em> (</em><em>default=True</em><em>)</em>) – If True, displays a violin plot of the summarized CVs (one aggregated value per feature) across subset sizes.</p></li>
<li><p><strong>random_seed</strong> (<em>int</em><em> or </em><em>None</em><em>, </em><em>optional</em><em> (</em><em>default=42</em><em>)</em>) – Seed for the random number generator, ensuring reproducibility.</p></li>
<li><p><strong>nan_policy</strong> (<em>str</em><em>, </em><em>optional</em><em> (</em><em>default=&quot;omit&quot;</em><em>)</em>) – <dl class="simple">
<dt>How to handle NaN values. Options are:</dt><dd><ul>
<li><p>”omit”: ignore NaNs during calculations,</p></li>
<li><p>”raise”: raise an error if NaNs are encountered,</p></li>
<li><p>”propagate”: allow NaNs to propagate in the output.</p></li>
</ul>
</dd>
</dl>
</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>pandas.DataFrame</strong> (<em>pandas.DataFrame</em><em> or </em><em>tuple of</em>) – <dl>
<dt>Depending on the flags <cite>return_raw</cite> and <cite>return_summary</cite>, the function returns:</dt><dd><ul>
<li><p>If both are True: a tuple (raw_df, summary_df)
* raw_df: DataFrame in long format with columns “feature”, “cv”, “subset_size”, and “bootstrap_id”.
* summary_df: DataFrame with the aggregated CV (using <cite>summary_func</cite>) per feature and subset size,</p>
<blockquote>
<div><p>with columns “subset_size”, “feature”, and “cv_summary”.</p>
</div></blockquote>
</li>
<li><p>If only one of the flags is True, only that DataFrame is returned.</p></li>
<li><p>If neither is True, returns None.</p></li>
</ul>
</dd>
</dl>
</p></li>
<li><p><strong>Raises</strong></p></li>
<li><p><strong>------</strong></p></li>
<li><p><strong>ValueError</strong> – If any of the specified subset sizes is larger than the number of rows in <cite>dataframe</cite>.</p></li>
<li><p><strong>Examples</strong></p></li>
<li><p><strong>--------</strong></p></li>
<li><p><strong>pd</strong> (<em>&gt;&gt;&gt; import pandas as</em>)</p></li>
<li><p><strong>np</strong> (<em>&gt;&gt;&gt; import numpy as</em>)</p></li>
<li><p><strong>pd.DataFrame</strong><strong>(</strong><strong>np.random.randn</strong><strong>(</strong><strong>100</strong> (<em>&gt;&gt;&gt; df =</em>)</p></li>
<li><p><strong>samples</strong> (<em>5</em><em>)</em><em>)  </em><em># 100</em>)</p></li>
<li><p><strong>features</strong> (<em>5</em>)</p></li>
<li><p><strong>raw_results</strong> (<em>&gt;&gt;&gt;</em>)</p></li>
<li><p><strong>bootstrap_variability</strong><strong>(</strong><strong>df</strong> (<em>summary_results =</em>)</p></li>
<li><p><strong>subset_sizes=</strong><strong>[</strong><strong>10</strong></p></li>
<li><p><strong>20</strong></p></li>
<li><p><strong>50</strong><strong>]</strong><strong>)</strong></p></li>
<li><p><strong>summary_results.head</strong><strong>(</strong><strong>)</strong> (<em>&gt;&gt;&gt;</em>) – subset_size feature  cv_summary</p></li>
<li><p><strong>0.123456</strong> (<em>0           10       A</em>)</p></li>
<li><p><strong>0.098765</strong> (<em>1           10       B</em>)</p></li>
<li><p><strong>0.110987</strong> (<em>2           20       A</em>)</p></li>
<li><p><strong>0.102345</strong> (<em>3           20       B</em>)</p></li>
<li><p><strong>0.095432</strong> (<em>4           50       A</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-opendvp.tools.stats_ttest">
<span id="opendvp-tools-stats-ttest-module"></span><h2>opendvp.tools.stats_ttest module<a class="headerlink" href="#module-opendvp.tools.stats_ttest" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.stats_ttest.ttest_adata">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.stats_ttest.</span></span><span class="sig-name descname"><span class="pre">ttest_adata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grouping</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">FDR_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.stats_ttest.ttest_adata" title="Link to this definition">¶</a></dt>
<dd><p>Perform a t-test for all columns of an AnnData object between two groups.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>AnnData</em>) – AnnData object.</p></li>
<li><p><strong>grouping</strong> (<em>str</em>) – Column header in adata.obs, categorizing different groups to test.</p></li>
<li><p><strong>group1</strong> (<em>str</em>) – Value in grouping column to be tested against.</p></li>
<li><p><strong>group2</strong> (<em>str</em>) – Value in grouping column to be tested against group 1.</p></li>
<li><p><strong>FDR_threshold</strong> (<em>float</em><em>, </em><em>default 0.05</em>) – The threshold for the FDR correction.</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>None</strong> – Results are saved to adata.var in-place.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></span></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-opendvp.tools">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-opendvp.tools" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.filter_adata_by_gates">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.</span></span><span class="sig-name descname"><span class="pre">filter_adata_by_gates</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.filter_adata_by_gates" title="Link to this definition">¶</a></dt>
<dd><p>Filter an AnnData object to retain only markers specified in the <cite>gates</cite> DataFrame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>AnnData</em>) – The annotated data matrix to be filtered (cells x markers).</p></li>
<li><p><strong>gates</strong> (<em>DataFrame</em>) – A DataFrame containing a ‘marker_id’ column with marker names to retain.
Optionally contains a ‘sample_id’ column for filtering markers specific to a sample.</p></li>
<li><p><strong>sample_id</strong> (<em>str</em><em>, </em><em>optional</em>) – If provided, filters the <cite>gates</cite> DataFrame to only include rows with this sample_id.</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>AnnData</strong> – A new AnnData object with the same cells but filtered to include only the gated markers.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.filter_by_abs_value">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.</span></span><span class="sig-name descname"><span class="pre">filter_by_abs_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">marker</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'quantile'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'above'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.filter_by_abs_value" title="Link to this definition">¶</a></dt>
<dd><p>Filter cells in an AnnData object by absolute marker value or quantile threshold.</p>
<p>This function creates a boolean mask for each cell based on a marker’s value, using either an absolute threshold or a quantile.
The result is stored as a new column in <cite>adata.obs</cite> and the filtered AnnData is returned.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></span></p>
</dd>
</dl>
<section id="id9">
<h3>Parameters:<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h3>
<dl class="simple">
<dt>adata<span class="classifier">ad.AnnData</span></dt><dd><p>AnnData object containing the data matrix and metadata.</p>
</dd>
<dt>marker<span class="classifier">str</span></dt><dd><p>Name of the marker to filter on (must be present in <cite>adata.var_names</cite>).</p>
</dd>
<dt>mode<span class="classifier">{‘absolute’, ‘quantile’}, default ‘quantile’</span></dt><dd><p>Whether to use an absolute value or quantile as the threshold.</p>
</dd>
<dt>value<span class="classifier">float or int, default 0.5</span></dt><dd><p>The threshold value. If mode is ‘absolute’, this is the absolute threshold. If ‘quantile’, this is the quantile (0 &lt; value &lt; 1).</p>
</dd>
<dt>keep<span class="classifier">{‘above’, ‘below’}, default ‘above’</span></dt><dd><p>Whether to keep cells ‘above’ or ‘below’ the threshold.</p>
</dd>
</dl>
</section>
<section id="id10">
<h3>Returns:<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h3>
<p>:
ad.AnnData</p>
<blockquote>
<div><p>A copy of the input AnnData with a new boolean column in <cite>.obs</cite> indicating which cells passed the filter.</p>
</div></blockquote>
</section>
<section id="id11">
<h3>Raises:<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h3>
<dl class="simple">
<dt>ValueError</dt><dd><p>If marker is not found, mutually exclusive arguments are violated, or parameters are invalid.</p>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.filter_by_annotation">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.</span></span><span class="sig-name descname"><span class="pre">filter_by_annotation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path_to_geojson</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">any_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'artefact'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.filter_by_annotation" title="Link to this definition">¶</a></dt>
<dd><p>Filter cells by annotation in a geojson file using spatial indexing.</p>
<p>This function assigns annotation classes to cells in an AnnData object by spatially joining cell centroids
with polygons from a GeoJSON file. Each annotation class becomes a boolean column in <cite>adata.obs</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>ad.AnnData</em>) – AnnData object with cell centroids in <cite>adata.obs[[‘X_centroid’, ‘Y_centroid’]]</cite> and unique ‘CellID’.</p></li>
<li><p><strong>path_to_geojson</strong> (<em>str</em>) – Path to the GeoJSON file containing polygon annotations with a ‘classification’ property.</p></li>
<li><p><strong>any_label</strong> (<em>str</em><em>, </em><em>default 'artefact'</em>) – Name for the column indicating if a cell is inside any annotation.</p></li>
<li><p><strong>plot_QC</strong> (<em>bool</em><em>, </em><em>default True</em>) – If True, enables plotting for quality control (not implemented).</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>ad.AnnData</strong> – The input AnnData with new boolean columns in <cite>.obs</cite> for each annotation class and a summary column.</p></li>
<li><p><strong>Raises</strong></p></li>
<li><p><strong>------</strong></p></li>
<li><p><strong>ValueError</strong> – If the GeoJSON is missing geometry, not polygons, or if required columns are missing.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.filter_by_ratio">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.</span></span><span class="sig-name descname"><span class="pre">filter_by_ratio</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_cycle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_cycle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'DAPI'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_ratio</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_ratio</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.05</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.filter_by_ratio" title="Link to this definition">¶</a></dt>
<dd><p>Filter cells by the ratio of two markers in an AnnData object.</p>
<p>This function computes the ratio between two markers (columns) for each cell, and flags cells
whose ratio falls within the specified range. The results are stored as new columns in <cite>.obs</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>ad.AnnData</em>) – AnnData object containing the data matrix and metadata.</p></li>
<li><p><strong>end_cycle</strong> (<em>str</em>) – Name of the marker/column for the numerator of the ratio.</p></li>
<li><p><strong>start_cycle</strong> (<em>str</em>) – Name of the marker/column for the denominator of the ratio.</p></li>
<li><p><strong>label</strong> (<em>str</em><em>, </em><em>default 'DAPI'</em>) – Label prefix for the new columns in <cite>.obs</cite>.</p></li>
<li><p><strong>min_ratio</strong> (<em>float</em><em>, </em><em>default 0.5</em>) – Minimum allowed ratio (exclusive).</p></li>
<li><p><strong>max_ratio</strong> (<em>float</em><em>, </em><em>default 1.05</em>) – Maximum allowed ratio (exclusive).</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>ad.AnnData</strong> – The input AnnData with new columns in <cite>.obs</cite> for the ratio and pass/fail flags.</p></li>
<li><p><strong>Raises</strong></p></li>
<li><p><strong>------</strong></p></li>
<li><p><strong>ValueError</strong> – If marker names are not found or if min_ratio &gt;= max_ratio.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.phenotype_cells">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.</span></span><span class="sig-name descname"><span class="pre">phenotype_cells</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phenotype</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'phenotype'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'imageid'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pheno_threshold_percent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pheno_threshold_abs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.phenotype_cells" title="Link to this definition">¶</a></dt>
<dd><p>Parameters:
adata (anndata.AnnData):</p>
<blockquote>
<div><p>The input AnnData object containing single-cell data for phenotyping.</p>
</div></blockquote>
<dl class="simple">
<dt>phenotype (pd.DataFrame):</dt><dd><p>A DataFrame specifying the gating strategy for cell phenotyping. It should outline the workflow for phenotype classification based on marker expression levels. An example workflow is available at [this GitHub link](<a class="reference external" href="https://github.com/ajitjohnson/scimap/blob/master/scimap/tests/_data/phenotype_workflow.csv">https://github.com/ajitjohnson/scimap/blob/master/scimap/tests/_data/phenotype_workflow.csv</a>).</p>
</dd>
<dt>gate (float, optional):</dt><dd><p>The threshold value for determining positive cell classification based on scaled data. By convention, values above this threshold are considered to indicate positive cells.</p>
</dd>
<dt>label (str):</dt><dd><p>The name of the column in <cite>adata.obs</cite> where the final phenotype classifications will be stored. This label will be used to access the phenotyping results within the <cite>AnnData</cite> object.</p>
</dd>
<dt>imageid (str, optional):</dt><dd><p>The name of the column in <cite>adata.obs</cite> that contains unique image identifiers. This is crucial for analyses that require differentiation of data based on the source image, especially when using phenotype threshold parameters (<cite>pheno_threshold_percent</cite> or <cite>pheno_threshold_abs</cite>).</p>
</dd>
<dt>pheno_threshold_percent (float, optional):</dt><dd><p>A threshold value (between 0 and 100) specifying the minimum percentage of cells that must exhibit a particular phenotype for it to be considered valid. Phenotypes not meeting this threshold are reclassified as ‘unknown’. This parameter is useful for minimizing the impact of low-frequency false positives.</p>
</dd>
<dt>pheno_threshold_abs (int, optional):</dt><dd><p>Similar to <cite>pheno_threshold_percent</cite>, but uses an absolute cell count instead of a percentage. Phenotypes with cell counts below this threshold are reclassified as ‘unknown’. This can help in addressing rare phenotype classifications that may not be meaningful.</p>
</dd>
<dt>verbose (bool):</dt><dd><p>If set to <cite>True</cite>, the function will print detailed messages about its progress and the steps being executed.</p>
</dd>
</dl>
<p>Returns:
adata (anndata.AnnData):</p>
<blockquote>
<div><p>The input AnnData object, updated to include the phenotype classifications for each cell. The phenotyping results can be found in <cite>adata.obs[label]</cite>, where <cite>label</cite> is the name specified by the user for the phenotype column.</p>
</div></blockquote>
<p>Example:
<a href="#id12"><span class="problematic" id="id13">``</span></a><a href="#id14"><span class="problematic" id="id15">`</span></a>python</p>
<p># Load the phenotype workflow CSV file
phenotype = pd.read_csv(‘path/to/csv/file/’)</p>
<p># Apply phenotyping to cells based on the specified workflow
adata = sm.tl.phenotype_cells(adata, phenotype=phenotype, gate=0.5, label=”phenotype”)</p>
<p><a href="#id16"><span class="problematic" id="id17">``</span></a><a href="#id18"><span class="problematic" id="id19">`</span></a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="opendvp.tools.spatial_autocorrelation">
<span class="sig-prename descclassname"><span class="pre">opendvp.tools.</span></span><span class="sig-name descname"><span class="pre">spatial_autocorrelation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'moran'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">('x_centroid',</span> <span class="pre">'y_centroid')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">island_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#opendvp.tools.spatial_autocorrelation" title="Link to this definition">¶</a></dt>
<dd><p>Compute spatial autocorrelation statistics (Moran’s I or Geary’s C) for each gene in an AnnData object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>AnnData</em>) – Annotated data matrix where observations are cells and variables are genes.</p></li>
<li><p><strong>method</strong> (<em>{'moran'</em><em>, </em><em>'geary'}</em><em>, </em><em>default 'moran'</em>) – Spatial statistic to compute: ‘moran’ or ‘geary’.</p></li>
<li><p><strong>x_y</strong> (<em>Sequence</em><em>[</em><em>str</em><em>]</em><em>, </em><em>default</em><em> (</em><em>&quot;x_centroid&quot;</em><em>, </em><em>&quot;y_centroid&quot;</em><em>)</em>) – Names of columns in <cite>adata.obs</cite> containing spatial coordinates.</p></li>
<li><p><strong>k</strong> (<em>int</em><em>, </em><em>default 8</em>) – Number of neighbors for Moran’s I (ignored for Geary’s C).</p></li>
<li><p><strong>threshold</strong> (<em>float</em><em>, </em><em>default 10.0</em>) – Distance threshold for neighbors for Geary’s C (ignored for Moran’s I).</p></li>
<li><p><strong>island_threshold</strong> (<em>float</em><em>, </em><em>default 0.1</em>) – If more than this fraction of samples are islands (no neighbors), raises error.</p></li>
<li><p><strong>Returns</strong></p></li>
<li><p><strong>-------</strong></p></li>
<li><p><strong>None</strong> – Results are added to adata.var in-place.</p></li>
<li><p><strong>Raises</strong></p></li>
<li><p><strong>------</strong></p></li>
<li><p><strong>ValueError</strong> – If method is not ‘moran’ or ‘geary’.</p></li>
<li><p><strong>RuntimeError</strong> – If too many islands are detected in Geary’s C mode.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
</dd></dl>

</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="opendvp.utils.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">opendvp.utils package</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="opendvp.preprocessing.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">opendvp.preprocessing package</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Jose Nimo
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">opendvp.tools package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-opendvp.tools.filter_adata_by_gates">opendvp.tools.filter_adata_by_gates module</a><ul>
<li><a class="reference internal" href="#opendvp.tools.filter_adata_by_gates.filter_adata_by_gates"><code class="docutils literal notranslate"><span class="pre">filter_adata_by_gates()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-opendvp.tools.filter_by_abs_value">opendvp.tools.filter_by_abs_value module</a><ul>
<li><a class="reference internal" href="#opendvp.tools.filter_by_abs_value.filter_by_abs_value"><code class="docutils literal notranslate"><span class="pre">filter_by_abs_value()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-opendvp.tools.filter_by_annotation">opendvp.tools.filter_by_annotation module</a><ul>
<li><a class="reference internal" href="#opendvp.tools.filter_by_annotation.filter_by_annotation"><code class="docutils literal notranslate"><span class="pre">filter_by_annotation()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-opendvp.tools.filter_by_ratio">opendvp.tools.filter_by_ratio module</a><ul>
<li><a class="reference internal" href="#opendvp.tools.filter_by_ratio.filter_by_ratio"><code class="docutils literal notranslate"><span class="pre">filter_by_ratio()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-opendvp.tools.filter_features_byNaNs">opendvp.tools.filter_features_byNaNs module</a><ul>
<li><a class="reference internal" href="#opendvp.tools.filter_features_byNaNs.filter_features_byNaNs"><code class="docutils literal notranslate"><span class="pre">filter_features_byNaNs()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-opendvp.tools.impute_gaussian">opendvp.tools.impute_gaussian module</a><ul>
<li><a class="reference internal" href="#opendvp.tools.impute_gaussian.gaussian"><code class="docutils literal notranslate"><span class="pre">gaussian()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-opendvp.tools.impute_single">opendvp.tools.impute_single module</a><ul>
<li><a class="reference internal" href="#opendvp.tools.impute_single.impute_single"><code class="docutils literal notranslate"><span class="pre">impute_single()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-opendvp.tools.phenotype">opendvp.tools.phenotype module</a><ul>
<li><a class="reference internal" href="#opendvp.tools.phenotype.phenotype_cells"><code class="docutils literal notranslate"><span class="pre">phenotype_cells()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-opendvp.tools.spatial_autocorrelation">opendvp.tools.spatial_autocorrelation module</a><ul>
<li><a class="reference internal" href="#opendvp.tools.spatial_autocorrelation.spatial_autocorrelation"><code class="docutils literal notranslate"><span class="pre">spatial_autocorrelation()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-opendvp.tools.spatial_hyperparameter_search">opendvp.tools.spatial_hyperparameter_search module</a><ul>
<li><a class="reference internal" href="#opendvp.tools.spatial_hyperparameter_search.spatial_hyperparameter_search"><code class="docutils literal notranslate"><span class="pre">spatial_hyperparameter_search()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-opendvp.tools.stats_anova">opendvp.tools.stats_anova module</a><ul>
<li><a class="reference internal" href="#opendvp.tools.stats_anova.anova_adata"><code class="docutils literal notranslate"><span class="pre">anova_adata()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-opendvp.tools.stats_average_samples">opendvp.tools.stats_average_samples module</a><ul>
<li><a class="reference internal" href="#opendvp.tools.stats_average_samples.calculate_category_averages"><code class="docutils literal notranslate"><span class="pre">calculate_category_averages()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-opendvp.tools.stats_bootstrap">opendvp.tools.stats_bootstrap module</a><ul>
<li><a class="reference internal" href="#opendvp.tools.stats_bootstrap.bootstrap_variability"><code class="docutils literal notranslate"><span class="pre">bootstrap_variability()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-opendvp.tools.stats_ttest">opendvp.tools.stats_ttest module</a><ul>
<li><a class="reference internal" href="#opendvp.tools.stats_ttest.ttest_adata"><code class="docutils literal notranslate"><span class="pre">ttest_adata()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-opendvp.tools">Module contents</a><ul>
<li><a class="reference internal" href="#opendvp.tools.filter_adata_by_gates"><code class="docutils literal notranslate"><span class="pre">filter_adata_by_gates()</span></code></a></li>
<li><a class="reference internal" href="#opendvp.tools.filter_by_abs_value"><code class="docutils literal notranslate"><span class="pre">filter_by_abs_value()</span></code></a></li>
<li><a class="reference internal" href="#opendvp.tools.filter_by_annotation"><code class="docutils literal notranslate"><span class="pre">filter_by_annotation()</span></code></a></li>
<li><a class="reference internal" href="#opendvp.tools.filter_by_ratio"><code class="docutils literal notranslate"><span class="pre">filter_by_ratio()</span></code></a></li>
<li><a class="reference internal" href="#opendvp.tools.phenotype_cells"><code class="docutils literal notranslate"><span class="pre">phenotype_cells()</span></code></a></li>
<li><a class="reference internal" href="#opendvp.tools.spatial_autocorrelation"><code class="docutils literal notranslate"><span class="pre">spatial_autocorrelation()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=000c92bf"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>